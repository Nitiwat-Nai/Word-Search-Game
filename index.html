<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search Learning</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- MODERN THEME & VARIABLES --- */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --accent-color: #FFD54F;
            --success-color: #48c6ef;
            --danger-color: #ff6b6b;
            --bg-color: #f0f4f8;
            --card-bg: #ffffff;
            --text-dark: #2d3436;
            --text-light: #ffffff;
            --shadow-sm: 0 4px 6px rgba(0,0,0,0.05);
            --shadow-md: 0 10px 15px rgba(0,0,0,0.1);
            --grid-line: #e2e8f0;
            --border-radius: 16px;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: var(--bg-color);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background-color: var(--card-bg);
            box-shadow: var(--shadow-md);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        /* --- HEADER & TITLE --- */
        header {
            background: var(--primary-gradient);
            color: var(--text-light);
            padding: 1.5rem 1rem;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1rem;
            position: relative;
            z-index: 10;
        }

        header h1 {
            font-size: 2rem;
            margin: 0;
            font-weight: 800;
            letter-spacing: 1px;
            cursor: pointer;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* --- NOTIFICATION TOAST --- */
        #autoplay-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background-color: #333;
            color: #fff;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        #autoplay-notification.show {
            transform: translateX(-50%) translateY(0);
        }

        /* --- SCREENS --- */
        .screen {
            padding: 1rem;
            display: none;
            flex-direction: column;
            gap: 1rem;
            animation: fadeIn 0.3s ease-out;
        }
        .active-screen { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- BUTTONS & CATEGORIES --- */
        .grid-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .main-btn {
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .main-btn:active { transform: scale(0.98); }

        .category-btn {
            background: white;
            color: #555;
            border: 2px solid #eee;
        }
        .category-btn:hover {
            border-color: #667eea;
            color: #667eea;
            background: #f8f9fa;
        }

        .difficulty-btn {
            background: var(--success-color);
            background-image: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            width: 100%;
            margin-top: 10px;
        }

        #restart-btn, #summary-btn {
            background: var(--text-dark);
            margin-top: 1rem;
        }

        /* --- GAME BOARD --- */
        #status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            font-weight: bold;
            color: #555;
        }

        #word-search-grid {
            display: grid;
            gap: 2px;
            background: var(--grid-line);
            padding: 2px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
            margin: 0 auto;
            max-width: 100%;
            user-select: none;
            touch-action: none; 
        }

        .grid-cell {
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 700;
            background: white;
            cursor: pointer;
            color: var(--text-dark);
            transition: background-color 0.1s;
        }

        .grid-cell.selected {
            background-color: #ffd700; 
            color: #333;
            transform: scale(0.95);
            border-radius: 4px;
        }

        .grid-cell.found {
            color: white;
        }

        .grid-cell.wrong-flash {
            background-color: var(--danger-color) !important;
            color: white !important;
            animation: wrongFlash 0.5s;
        }
        @keyframes wrongFlash { 0%, 100% { background-color: var(--danger-color); } 50% { opacity: 0.5; } }

        /* --- CLUE LIST --- */
        #clue-panel {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }
        #clue-panel h3 { margin: 0 0 10px 0; color: #667eea; }
        
        #clue-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
        }

        .clue-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            border: 1px solid #eee;
            transition: all 0.3s;
        }
        .clue-item.found {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
            opacity: 0.6;
        }
        .clue-item.hint-used {
            border: 1px dashed var(--danger-color);
        }

        /* --- SUMMARY SCREEN --- */
        .summary-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-sm);
            text-align: left;
        }
        .summary-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 1rem;
        }
        .summary-item span:first-child { font-weight: bold; color: #667eea; }
        .summary-item span:last-child { color: #555; }

        .pulsing-title { animation: slowPulse 2s infinite; color: #FFD54F; }
        @keyframes slowPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

    </style>
</head>
<body>

    <div class="container">
        <div id="autoplay-notification"></div>

        <header>
            <h1 id="game-title">Word Search üîç</h1>
        </header>

        <div id="start-screen" class="screen active-screen">
            <div style="text-align: center; margin-bottom: 1rem;">
                <h2 style="margin:0; color: #667eea;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</h2>
                <p style="color: #888; font-size: 0.9rem;">‡πÅ‡∏ï‡∏∞ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
            </div>
            
            <div class="grid-buttons">
                <button class="main-btn category-btn" data-category="animals">ü¶Å ‡∏™‡∏±‡∏ï‡∏ß‡πå (Animals)</button>
                <button class="main-btn category-btn" data-category="fruits">üçé ‡∏ú‡∏•‡πÑ‡∏°‡πâ (Fruits)</button>
                <button class="main-btn category-btn" data-category="foods">üçï ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Foods)</button>
                <button class="main-btn category-btn" data-category="sports">‚öΩ ‡∏Å‡∏µ‡∏¨‡∏≤ (Sports)</button>
                <button class="main-btn category-btn" data-category="colors">üé® ‡∏™‡∏µ (Colors)</button>
                <button class="main-btn category-btn" data-category="jobs">üëÆ ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û (Jobs)</button>
                <button class="main-btn category-btn" data-category="vehicles">üöó ‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞</button>
                <button class="main-btn category-btn" data-category="countries">üåè ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</button>
                <button class="main-btn category-btn" data-category="technology">üíª ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</button>
                <button class="main-btn category-btn" data-category="clothes">üëï ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤</button>
                <button class="main-btn category-btn" data-category="weather">‚õÖ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</button>
                <button class="main-btn category-btn" data-category="music">üéµ ‡∏î‡∏ô‡∏ï‡∏£‡∏µ</button>
            </div>
        </div>

        <div id="difficulty-screen" class="screen">
            <h2 id="difficulty-category-title" style="text-align: center; color: #555;">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ...</h2>
            <button class="main-btn difficulty-btn" data-difficulty="easy" id="diff-easy">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢</button>
            <button class="main-btn difficulty-btn" data-difficulty="hard" id="diff-hard" style="background-image: linear-gradient(to right, #fa709a 0%, #fee140 100%);">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≤‡∏Å</button>
            <button class="main-btn category-btn" onclick="showScreen('start-screen')" style="margin-top:20px;">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>

        <div id="game-screen" class="screen">
            <div id="status-bar">
                <span id="score">0/10</span>
                <span id="timer-display">00:00</span>
            </div>

            <div id="word-search-grid"></div>

            <div id="clue-panel">
                <h3>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ</h3>
                <ul id="clue-list"></ul>
            </div>
            
            <button id="restart-btn" class="main-btn">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
        
        <div id="summary-screen" class="screen">
            <div style="text-align: center;">
                <h2 style="color: var(--success-color);">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! üéâ</h2>
                <div class="summary-stat">
                    <p id="summary-score" style="font-size: 1.2rem; font-weight: bold;"></p>
                    <p id="summary-time" style="color: #777;"></p>
                </div>
            </div>
            
            <div class="summary-content">
                <h3 style="margin:0; border-bottom: 2px solid #eee; padding-bottom: 10px;">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h3>
                <ul id="summary-list" class="summary-list"></ul>
            </div>

            <button id="summary-btn" class="main-btn">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        </div>
    </div>

    <script>
        // --- DATA: WORD CATEGORIES ---
        const WORD_CATEGORIES = {
            'animals': { name: '‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤', pool: [{ w: "CAT", t: "‡πÅ‡∏°‡∏ß" }, { w: "DOG", t: "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç" }, { w: "LION", t: "‡∏™‡∏¥‡∏á‡πÇ‡∏ï" }, { w: "TIGER", t: "‡πÄ‡∏™‡∏∑‡∏≠" }, { w: "BEAR", t: "‡∏´‡∏°‡∏µ" }, { w: "ZEBRA", t: "‡∏°‡πâ‡∏≤‡∏•‡∏≤‡∏¢" }, { w: "PIG", t: "‡∏´‡∏°‡∏π" }, { w: "COW", t: "‡∏ß‡∏±‡∏ß" }, { w: "DUCK", t: "‡πÄ‡∏õ‡πá‡∏î" }, { w: "FISH", t: "‡∏õ‡∏•‡∏≤" }, { w: "BIRD", t: "‡∏ô‡∏Å" }, { w: "FROG", t: "‡∏Å‡∏ö" }, { w: "MONKEY", t: "‡∏•‡∏¥‡∏á" }, { w: "SNAKE", t: "‡∏á‡∏π" }, { w: "RABBIT", t: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢" }, { w: "SHEEP", t: "‡πÅ‡∏Å‡∏∞" }, { w: "HORSE", t: "‡∏°‡πâ‡∏≤" }, { w: "ELEPHANT", t: "‡∏ä‡πâ‡∏≤‡∏á" }, { w: "GIRAFFE", t: "‡∏¢‡∏µ‡∏£‡∏≤‡∏ü" }, { w: "PANDA", t: "‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤" }] },
            'fruits': { name: '‡∏ú‡∏•‡πÑ‡∏°‡πâ', pool: [{ w: "APPLE", t: "‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•" }, { w: "BANANA", t: "‡∏Å‡∏•‡πâ‡∏ß‡∏¢" }, { w: "ORANGE", t: "‡∏™‡πâ‡∏°" }, { w: "GRAPE", t: "‡∏≠‡∏á‡∏∏‡πà‡∏ô" }, { w: "MANGO", t: "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á" }, { w: "PAPAYA", t: "‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠" }, { w: "COCONUT", t: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß" }, { w: "BERRY", t: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà" }, { w: "MELON", t: "‡πÄ‡∏°‡∏•‡πà‡∏≠‡∏ô" }, { w: "LEMON", t: "‡πÄ‡∏•‡∏°‡∏≠‡∏ô" }, { w: "PEACH", t: "‡∏•‡∏π‡∏Å‡∏û‡∏µ‡∏ä" }, { w: "CHERRY", t: "‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà" }, { w: "KIWI", t: "‡∏Å‡∏µ‡∏ß‡∏µ‡πà" }, { w: "PEAR", t: "‡∏•‡∏π‡∏Å‡πÅ‡∏û‡∏£‡πå" }, { w: "LIME", t: "‡∏°‡∏∞‡∏ô‡∏≤‡∏ß" }, { w: "PLUM", t: "‡∏•‡∏π‡∏Å‡∏û‡∏•‡∏±‡∏°" }, { w: "DURIAN", t: "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" }, { w: "GUAVA", t: "‡∏ù‡∏£‡∏±‡πà‡∏á" }, { w: "LYCHEE", t: "‡∏•‡∏¥‡πâ‡∏ô‡∏à‡∏µ‡πà" }, { w: "DATE", t: "‡∏≠‡∏¥‡∏ô‡∏ó‡∏ú‡∏•‡∏±‡∏°" }] },
            'foods': { name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£', pool: [{ w: "RICE", t: "‡∏Ç‡πâ‡∏≤‡∏ß" }, { w: "SOUP", t: "‡∏ã‡∏∏‡∏õ" }, { w: "EGG", t: "‡πÑ‡∏Ç‡πà" }, { w: "MEAT", t: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠" }, { w: "FISH", t: "‡∏õ‡∏•‡∏≤" }, { w: "BREAD", t: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á" }, { w: "CAKE", t: "‡πÄ‡∏Ñ‡πâ‡∏Å" }, { w: "PIZZA", t: "‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤" }, { w: "BURGER", t: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Å‡∏≠‡∏£‡πå" }, { w: "SALAD", t: "‡∏™‡∏•‡∏±‡∏î" }, { w: "NOODLE", t: "‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß" }, { w: "PASTA", t: "‡∏û‡∏≤‡∏™‡∏ï‡πâ‡∏≤" }, { w: "STEAK", t: "‡∏™‡πÄ‡∏ï‡πá‡∏Å" }, { w: "SUSHI", t: "‡∏ã‡∏π‡∏ä‡∏¥" }, { w: "DONUT", t: "‡πÇ‡∏î‡∏ô‡∏±‡∏ó" }, { w: "MILK", t: "‡∏ô‡∏°" }, { w: "TEA", t: "‡∏ä‡∏≤" }, { w: "COFFEE", t: "‡∏Å‡∏≤‡πÅ‡∏ü" }, { w: "JUICE", t: "‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ" }, { w: "WATER", t: "‡∏ô‡πâ‡∏≥" }] },
            'sports': { name: '‡∏Å‡∏µ‡∏¨‡∏≤', pool: [{ w: "RUN", t: "‡∏ß‡∏¥‡πà‡∏á" }, { w: "JUMP", t: "‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î" }, { w: "SWIM", t: "‡∏ß‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥" }, { w: "GOLF", t: "‡∏Å‡∏≠‡∏•‡πå‡∏ü" }, { w: "BOXING", t: "‡∏°‡∏ß‡∏¢" }, { w: "TENNIS", t: "‡πÄ‡∏ó‡∏ô‡∏ô‡∏¥‡∏™" }, { w: "JUDO", t: "‡∏¢‡∏π‡πÇ‡∏î" }, { w: "RUGBY", t: "‡∏£‡∏±‡∏Å‡∏ö‡∏µ‡πâ" }, { w: "YOGA", t: "‡πÇ‡∏¢‡∏Ñ‡∏∞" }, { w: "HOCKEY", t: "‡∏Æ‡∏≠‡∏Å‡∏Å‡∏µ‡πâ" }, { w: "SOCCER", t: "‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•" }, { w: "KARATE", t: "‡∏Ñ‡∏≤‡∏£‡∏≤‡πÄ‡∏ï‡πâ" }, { w: "SURF", t: "‡πÇ‡∏ï‡πâ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô" }, { w: "SKI", t: "‡∏™‡∏Å‡∏µ" }, { w: "SKATE", t: "‡∏™‡πÄ‡∏Å‡πá‡∏ï" }, { w: "CYCLING", t: "‡∏õ‡∏±‡πà‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô" }, { w: "RACING", t: "‡πÅ‡∏Ç‡πà‡∏á‡∏£‡∏ñ" }, { w: "DIVING", t: "‡∏î‡∏≥‡∏ô‡πâ‡∏≥" }, { w: "ARCHERY", t: "‡∏¢‡∏¥‡∏á‡∏ò‡∏ô‡∏π" }, { w: "SUMO", t: "‡∏ã‡∏π‡πÇ‡∏°‡πà" }] },
            'colors': { name: '‡∏™‡∏µ', pool: [{ w: "RED", t: "‡∏™‡∏µ‡πÅ‡∏î‡∏á" }, { w: "BLUE", t: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô" }, { w: "GREEN", t: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" }, { w: "PINK", t: "‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π" }, { w: "BLACK", t: "‡∏™‡∏µ‡∏î‡∏≥" }, { w: "WHITE", t: "‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß" }, { w: "GREY", t: "‡∏™‡∏µ‡πÄ‡∏ó‡∏≤" }, { w: "GOLD", t: "‡∏™‡∏µ‡∏ó‡∏≠‡∏á" }, { w: "SILVER", t: "‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô" }, { w: "BROWN", t: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•" }, { w: "YELLOW", t: "‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" }, { w: "PURPLE", t: "‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á" }, { w: "ORANGE", t: "‡∏™‡∏µ‡∏™‡πâ‡∏°" }, { w: "VIOLET", t: "‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏Ñ‡∏£‡∏≤‡∏°" }, { w: "INDIGO", t: "‡∏™‡∏µ‡∏Ñ‡∏£‡∏≤‡∏°" }, { w: "CREAM", t: "‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°" }, { w: "NAVY", t: "‡∏™‡∏µ‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤" }, { w: "CYAN", t: "‡∏™‡∏µ‡∏ü‡πâ‡∏≤" }, { w: "LIME", t: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏ô‡∏≤‡∏ß" }, { w: "TEAL", t: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" }] },
            'jobs': { name: '‡∏≠‡∏≤‡∏ä‡∏µ‡∏û', pool: [{ w: "DOCTOR", t: "‡∏´‡∏°‡∏≠" }, { w: "NURSE", t: "‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•" }, { w: "TEACHER", t: "‡∏Ñ‡∏£‡∏π" }, { w: "POLICE", t: "‡∏ï‡∏≥‡∏£‡∏ß‡∏à" }, { w: "SOLDIER", t: "‡∏ó‡∏´‡∏≤‡∏£" }, { w: "CHEF", t: "‡∏û‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡∏ß" }, { w: "PILOT", t: "‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô" }, { w: "JUDGE", t: "‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏û‡∏≤‡∏Å‡∏©‡∏≤" }, { w: "ARTIST", t: "‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô" }, { w: "SINGER", t: "‡∏ô‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏á" }, { w: "ACTOR", t: "‡∏ô‡∏±‡∏Å‡πÅ‡∏™‡∏î‡∏á" }, { w: "DRIVER", t: "‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ" }, { w: "FARMER", t: "‡∏ä‡∏≤‡∏ß‡∏ô‡∏≤" }, { w: "VET", t: "‡∏™‡∏±‡∏ï‡∏ß‡πÅ‡∏û‡∏ó‡∏¢‡πå" }, { w: "BAKER", t: "‡∏Ñ‡∏ô‡∏≠‡∏ö‡∏Ç‡∏ô‡∏°" }, { w: "MONK", t: "‡∏û‡∏£‡∏∞‡∏™‡∏á‡∏Ü‡πå" }, { w: "GUIDE", t: "‡πÑ‡∏Å‡∏î‡πå" }, { w: "MAID", t: "‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô" }, { w: "GUARD", t: "‡∏¢‡∏≤‡∏°" }, { w: "CLERK", t: "‡πÄ‡∏™‡∏°‡∏µ‡∏¢‡∏ô" }] },
            'vehicles': { name: '‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞', pool: [{ w: "CAR", t: "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå" }, { w: "BUS", t: "‡∏£‡∏ñ‡∏ö‡∏±‡∏™" }, { w: "VAN", t: "‡∏£‡∏ñ‡∏ï‡∏π‡πâ" }, { w: "TAXI", t: "‡πÅ‡∏ó‡πá‡∏Å‡∏ã‡∏µ‡πà" }, { w: "BIKE", t: "‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô" }, { w: "TRAIN", t: "‡∏£‡∏ñ‡πÑ‡∏ü" }, { w: "BOAT", t: "‡πÄ‡∏£‡∏∑‡∏≠" }, { w: "SHIP", t: "‡πÄ‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡∏ç‡πà" }, { w: "PLANE", t: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô" }, { w: "JET", t: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô‡πÄ‡∏à‡πá‡∏ó" }, { w: "TRUCK", t: "‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å" }, { w: "JEEP", t: "‡∏£‡∏ñ‡∏à‡∏µ‡πä‡∏õ" }, { w: "MOTO", t: "‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå" }, { w: "YACHT", t: "‡πÄ‡∏£‡∏∑‡∏≠‡∏¢‡∏≠‡∏ä‡∏ó‡πå" }, { w: "FERRY", t: "‡πÄ‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡∏ü‡∏≤‡∏Å" }, { w: "SUBWAY", t: "‡∏£‡∏ñ‡πÑ‡∏ü‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô" }, { w: "TUKTUK", t: "‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏∏‡πä‡∏Å" }, { w: "CANOE", t: "‡πÄ‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡∏ô‡∏π" }, { w: "ROCKET", t: "‡∏à‡∏£‡∏ß‡∏î" }, { w: "TANK", t: "‡∏£‡∏ñ‡∏ñ‡∏±‡∏á" }] },
            'countries': { name: '‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®', pool: [{ w: "THAI", t: "‡πÑ‡∏ó‡∏¢" }, { w: "CHINA", t: "‡∏à‡∏µ‡∏ô" }, { w: "JAPAN", t: "‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô" }, { w: "KOREA", t: "‡πÄ‡∏Å‡∏≤‡∏´‡∏•‡∏µ" }, { w: "INDIA", t: "‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢" }, { w: "USA", t: "‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤" }, { w: "UK", t: "‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©" }, { w: "FRANCE", t: "‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™" }, { w: "ITALY", t: "‡∏≠‡∏¥‡∏ï‡∏≤‡∏•‡∏µ" }, { w: "SPAIN", t: "‡∏™‡πÄ‡∏õ‡∏ô" }, { w: "BRAZIL", t: "‡∏ö‡∏£‡∏≤‡∏ã‡∏¥‡∏•" }, { w: "CHILE", t: "‡∏ä‡∏¥‡∏•‡∏µ" }, { w: "PERU", t: "‡πÄ‡∏õ‡∏£‡∏π" }, { w: "EGYPT", t: "‡∏≠‡∏µ‡∏¢‡∏¥‡∏õ‡∏ï‡πå" }, { w: "IRAN", t: "‡∏≠‡∏¥‡∏´‡∏£‡πà‡∏≤‡∏ô" }, { w: "IRAQ", t: "‡∏≠‡∏¥‡∏£‡∏±‡∏Å" }, { w: "LAOS", t: "‡∏•‡∏≤‡∏ß" }, { w: "BURMA", t: "‡∏û‡∏°‡πà‡∏≤" }, { w: "RUSSIA", t: "‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢" }, { w: "CANADA", t: "‡πÅ‡∏Ñ‡∏ô‡∏≤‡∏î‡∏≤" }] },
            'technology': { name: '‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ', pool: [{ w: "MOUSE", t: "‡πÄ‡∏°‡∏≤‡∏™‡πå" }, { w: "CODE", t: "‡∏£‡∏´‡∏±‡∏™" }, { w: "DATA", t: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" }, { w: "WIFI", t: "‡πÑ‡∏ß‡πÑ‡∏ü" }, { w: "APP", t: "‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô" }, { w: "WEB", t: "‡πÄ‡∏ß‡πá‡∏ö" }, { w: "LINK", t: "‡∏•‡∏¥‡∏á‡∏Å‡πå" }, { w: "FILE", t: "‡πÑ‡∏ü‡∏•‡πå" }, { w: "JAVA", t: "‡∏à‡∏≤‡∏ß‡∏≤" }, { w: "ROBOT", t: "‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå" }, { w: "PHONE", t: "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" }, { w: "EMAIL", t: "‡∏≠‡∏µ‡πÄ‡∏°‡∏•" }, { w: "CLICK", t: "‡∏Ñ‡∏•‡∏¥‡∏Å" }, { w: "TYPE", t: "‡∏û‡∏¥‡∏°‡∏û‡πå" }, { w: "SAVE", t: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å" }, { w: "COPY", t: "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å" }, { w: "PASTE", t: "‡∏ß‡∏≤‡∏á" }, { w: "LOGIN", t: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" }, { w: "CHAT", t: "‡πÅ‡∏ä‡∏ó" }, { w: "ZOOM", t: "‡∏ã‡∏π‡∏°" }] },
            'clothes': { name: '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤', pool: [{ w: "SHIRT", t: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡∏¥‡πâ‡∏ï" }, { w: "DRESS", t: "‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏£‡∏™" }, { w: "SKIRT", t: "‡∏Å‡∏£‡∏∞‡πÇ‡∏õ‡∏£‡∏á" }, { w: "JEANS", t: "‡∏¢‡∏µ‡∏ô‡∏™‡πå" }, { w: "COAT", t: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÇ‡∏Ñ‡πâ‡∏ó" }, { w: "HAT", t: "‡∏´‡∏°‡∏ß‡∏Å" }, { w: "CAP", t: "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ" }, { w: "SHOE", t: "‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤" }, { w: "SOCK", t: "‡∏ñ‡∏∏‡∏á‡πÄ‡∏ó‡πâ‡∏≤" }, { w: "BELT", t: "‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏±‡∏î" }, { w: "BOOT", t: "‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏ö‡∏π‡∏ó" }, { w: "RING", t: "‡πÅ‡∏´‡∏ß‡∏ô" }, { w: "WATCH", t: "‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤" }, { w: "VEST", t: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏±‡πä‡∏Å" }, { w: "TIE", t: "‡πÄ‡∏ô‡∏Ñ‡πÑ‡∏ó" }, { w: "SUIT", t: "‡∏ä‡∏∏‡∏î‡∏™‡∏π‡∏ó" }, { w: "BAG", t: "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤" }, { w: "PANTS", t: "‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á" }, { w: "SCARF", t: "‡∏ú‡πâ‡∏≤‡∏û‡∏±‡∏ô‡∏Ñ‡∏≠" }, { w: "MASK", t: "‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏Å" }] },
            'weather': { name: '‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®', pool: [{ w: "SUN", t: "‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå" }, { w: "RAIN", t: "‡∏ù‡∏ô" }, { w: "SNOW", t: "‡∏´‡∏¥‡∏°‡∏∞" }, { w: "WIND", t: "‡∏•‡∏°" }, { w: "HOT", t: "‡∏£‡πâ‡∏≠‡∏ô" }, { w: "COLD", t: "‡∏´‡∏ô‡∏≤‡∏ß" }, { w: "STORM", t: "‡∏û‡∏≤‡∏¢‡∏∏" }, { w: "CLOUD", t: "‡πÄ‡∏°‡∏Ü" }, { w: "FOG", t: "‡∏´‡∏°‡∏≠‡∏Å" }, { w: "DRY", t: "‡πÅ‡∏´‡πâ‡∏á" }, { w: "WET", t: "‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å" }, { w: "ICE", t: "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á" }, { w: "HEAT", t: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô" }, { w: "HAIL", t: "‡∏•‡∏π‡∏Å‡πÄ‡∏´‡πá‡∏ö" }, { w: "WARM", t: "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô" }, { w: "COOL", t: "‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏ö‡∏≤‡∏¢" }, { w: "DARK", t: "‡∏°‡∏∑‡∏î" }, { w: "CLEAR", t: "‡πÅ‡∏à‡πà‡∏°‡πÉ‡∏™" }, { w: "MIST", t: "‡∏´‡∏°‡∏≠‡∏Å‡∏ö‡∏≤‡∏á" }, { w: "DEW", t: "‡∏ô‡πâ‡∏≥‡∏Ñ‡πâ‡∏≤‡∏á" }] },
            'music': { name: '‡∏î‡∏ô‡∏ï‡∏£‡∏µ', pool: [{ w: "SONG", t: "‡πÄ‡∏û‡∏•‡∏á" }, { w: "BAND", t: "‡∏ß‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ" }, { w: "ROCK", t: "‡∏£‡πá‡∏≠‡∏Ñ" }, { w: "POP", t: "‡∏õ‡πä‡∏≠‡∏õ" }, { w: "JAZZ", t: "‡πÅ‡∏à‡πä‡∏™" }, { w: "DRUM", t: "‡∏Å‡∏•‡∏≠‡∏á" }, { w: "BASS", t: "‡πÄ‡∏ö‡∏™" }, { w: "PIANO", t: "‡πÄ‡∏õ‡∏µ‡∏¢‡πÇ‡∏ô" }, { w: "NOTE", t: "‡πÇ‡∏ô‡πâ‡∏ï" }, { w: "SING", t: "‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á" }, { w: "PLAY", t: "‡πÄ‡∏•‡πà‡∏ô" }, { w: "LOUD", t: "‡∏î‡∏±‡∏á" }, { w: "SOFT", t: "‡πÄ‡∏ö‡∏≤" }, { w: "TUNE", t: "‡∏ó‡πà‡∏ß‡∏á‡∏ó‡∏≥‡∏ô‡∏≠‡∏á" }, { w: "BEAT", t: "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞" }, { w: "RAP", t: "‡πÅ‡∏£‡πá‡∏õ" }, { w: "SHOW", t: "‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á" }, { w: "DANCE", t: "‡πÄ‡∏ï‡πâ‡∏ô" }, { w: "DJ", t: "‡∏î‡∏µ‡πÄ‡∏à" }, { w: "CD", t: "‡∏ã‡∏µ‡∏î‡∏µ" }] }
        };

        const PASTEL_COLORS = [
            '#FFC0CB', '#87CEFA', '#90EE90', '#F08080', '#DDA0DD', 
            '#B0E0E6', '#F0E68C', '#AFEEEE', '#E6E6FA', '#FFDAB9'
        ];

        const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        // --- GAME STATE ---
        let GRID_SIZE = 8;
        let targetWords = [];
        let grid = [];
        let placedWordsMeta = [];
        let selectedCells = [];
        let startCell = null;
        let timerInterval;
        let startTime;
        let totalTimeSeconds = 0;
        let isAutoplayMode = false;
        let isGameRunning = false;
        
        let lastTap = 0;
        const DBL_TAP_THRESHOLD = 300;

        const gridEl = document.getElementById('word-search-grid');
        const clueListEl = document.getElementById('clue-list');
        const notifEl = document.getElementById('autoplay-notification');
        const summaryListEl = document.getElementById('summary-list');

        // --- SPEECH FUNCTION ---
        function speakText(text, lang) {
            return new Promise((resolve) => {
                if (!('speechSynthesis' in window)) {
                    resolve();
                    return;
                }
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = (lang === 'en-US') ? 0.8 : 1.0; 
                utterance.onend = () => resolve();
                utterance.onerror = () => resolve();
                window.speechSynthesis.speak(utterance);
            });
        }

        // --- CORE FUNCTIONS ---
        function showNotification(message) {
            notifEl.textContent = message;
            notifEl.classList.add('show');
            setTimeout(() => notifEl.classList.remove('show'), 3000);
        }

        function toggleAutoplayMode() {
            isAutoplayMode = !isAutoplayMode;
            const title = document.getElementById('game-title');
            if (isAutoplayMode) {
                title.classList.add('pulsing-title');
                showNotification("‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ü§ñ");
            } else {
                title.classList.remove('pulsing-title');
                showNotification("‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥");
            }
        }

        function handleTitleTap() {
            const now = Date.now();
            if (now - lastTap < DBL_TAP_THRESHOLD) {
                toggleAutoplayMode();
                lastTap = 0;
            } else {
                lastTap = now;
            }
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById(id).classList.add('active-screen');
            if (id !== 'game-screen') stopTimer();
        }

        function selectCategory(catKey) {
            const cat = WORD_CATEGORIES[catKey];
            document.getElementById('difficulty-category-title').textContent = `‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${cat.name}`;
            
            const btnEasy = document.getElementById('diff-easy');
            btnEasy.textContent = `‡∏á‡πà‡∏≤‡∏¢ (6x6, 6 ‡∏Ñ‡∏≥)`;
            btnEasy.onclick = () => startGame(catKey, 6, 6);

            const btnHard = document.getElementById('diff-hard');
            btnHard.textContent = `‡∏¢‡∏≤‡∏Å (10x10, 10 ‡∏Ñ‡∏≥)`;
            btnHard.onclick = () => startGame(catKey, 10, 10);

            showScreen('difficulty-screen');
        }

        async function startGame(catKey, size, count) {
            isGameRunning = true;
            
            const cat = WORD_CATEGORIES[catKey];
            const shuffled = [...cat.pool].sort(() => 0.5 - Math.random());
            let selected = shuffled.slice(0, count);
            
            // Check word length vs grid size
            const maxLen = Math.max(...selected.map(x => x.w.length));
            // Auto resize if words are too long
            GRID_SIZE = Math.max(size, maxLen);

            targetWords = selected.map(obj => ({
                word: obj.w,
                clue: obj.t,
                found: false,
                color: null
            }));

            // Guaranteed Generation
            if (!generatePuzzleGuaranteed()) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
                return;
            }

            renderGrid();
            renderClues();
            startTimer();
            showScreen('game-screen');

            // Autoplay Logic
            if (isAutoplayMode) {
                gridEl.style.pointerEvents = 'none'; 
                await new Promise(r => setTimeout(r, 1500)); // Initial Delay
                if(isGameRunning) runAutoplayLoop();
            } else {
                gridEl.style.pointerEvents = 'auto';
            }
        }

        function generatePuzzleGuaranteed() {
            let attempts = 0;
            const maxAttempts = 500;
            
            while(attempts < maxAttempts) {
                grid = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill(''));
                placedWordsMeta = [];
                let placedCount = 0;

                const wordsToPlace = [...targetWords].sort((a,b) => b.word.length - a.word.length);

                for (let wObj of wordsToPlace) {
                    if (placeSingleWord(wObj.word)) placedCount++;
                }

                if (placedCount === targetWords.length) {
                    fillEmptyCells();
                    return true;
                }
                attempts++;
            }
            return false;
        }

        function placeSingleWord(word) {
            const directions = [[0,1], [1,0], [1,1], [0,-1], [-1,0], [-1,-1], [1,-1], [-1,1]];
            let tries = 0;
            while(tries < 200) {
                const r = Math.floor(Math.random() * GRID_SIZE);
                const c = Math.floor(Math.random() * GRID_SIZE);
                const dir = directions[Math.floor(Math.random() * directions.length)];
                
                if (canPlace(r, c, word, dir)) {
                    for(let i=0; i<word.length; i++) {
                        grid[r + i*dir[0]][c + i*dir[1]] = word[i];
                    }
                    placedWordsMeta.push({
                        word: word,
                        start: {r, c},
                        end: {r: r + (word.length-1)*dir[0], c: c + (word.length-1)*dir[1]}
                    });
                    return true;
                }
                tries++;
            }
            return false;
        }

        function canPlace(r, c, word, dir) {
            const lastR = r + (word.length - 1) * dir[0];
            const lastC = c + (word.length - 1) * dir[1];
            if (lastR < 0 || lastR >= GRID_SIZE || lastC < 0 || lastC >= GRID_SIZE) return false;

            for(let i=0; i<word.length; i++) {
                const cell = grid[r + i*dir[0]][c + i*dir[1]];
                if (cell !== '' && cell !== word[i]) return false;
            }
            return true;
        }

        function fillEmptyCells() {
            for(let r=0; r<GRID_SIZE; r++) {
                for(let c=0; c<GRID_SIZE; c++) {
                    if(grid[r][c] === '') grid[r][c] = ALPHABET[Math.floor(Math.random() * ALPHABET.length)];
                }
            }
        }

        function renderGrid() {
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            
            for(let r=0; r<GRID_SIZE; r++) {
                for(let c=0; c<GRID_SIZE; c++) {
                    const div = document.createElement('div');
                    div.className = 'grid-cell';
                    div.textContent = grid[r][c];
                    div.dataset.r = r;
                    div.dataset.c = c;
                    gridEl.appendChild(div);
                }
            }
        }

        function renderClues() {
            clueListEl.innerHTML = '';
            targetWords.forEach((item, idx) => {
                const li = document.createElement('li');
                li.className = 'clue-item';
                li.innerHTML = `<span>${item.clue}</span><span class="clue-word-text" style="display:none; font-weight:bold; display:block; color:#333;">${item.word}</span>`;
                li.id = `clue-${idx}`;
                li.onclick = () => { if(!isAutoplayMode) giveHint(idx); };
                clueListEl.appendChild(li);
            });
            updateStatus();
        }

        function updateStatus() {
            const found = targetWords.filter(t => t.found).length;
            document.getElementById('score').textContent = `‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå: ${found}/${targetWords.length}`;
        }

        // --- INTERACTION HANDLERS ---
        let isSelecting = false;

        function getCell(r, c) { return document.querySelector(`.grid-cell[data-r='${r}'][data-c='${c}']`); }

        function handleStart(e) {
            if(isAutoplayMode) return;
            const cell = e.target.closest('.grid-cell');
            if(!cell) return;
            isSelecting = true;
            startCell = cell;
            clearSelection();
            selectCell(cell);
        }

        function handleMove(e) {
            if(!isSelecting || !startCell) return;
            e.preventDefault(); 
            const touch = e.touches ? e.touches[0] : e;
            const target = document.elementFromPoint(touch.clientX, touch.clientY);
            const cell = target?.closest('.grid-cell');
            if(cell) checkLine(startCell, cell);
        }

        function handleEnd() {
            if(!isSelecting) return;
            isSelecting = false;
            checkWordMatch();
        }

        function selectCell(cell) {
            if(!cell.classList.contains('found')) {
                cell.classList.add('selected');
                selectedCells.push(cell);
            }
        }

        function clearSelection() {
            selectedCells.forEach(c => c.classList.remove('selected'));
            selectedCells = [];
        }

        function checkLine(start, end) {
            clearSelection();
            const r1 = parseInt(start.dataset.r);
            const c1 = parseInt(start.dataset.c);
            const r2 = parseInt(end.dataset.r);
            const c2 = parseInt(end.dataset.c);

            const dr = Math.sign(r2 - r1);
            const dc = Math.sign(c2 - c1);

            if((r1===r2 && c1===c2) || (r1===r2) || (c1===c2) || (Math.abs(r1-r2) === Math.abs(c1-c2))) {
                let r = r1, c = c1;
                if (r1===r2 && c1===c2) {
                    selectCell(start);
                } else {
                    while(true) {
                        const cell = getCell(r, c);
                        if(cell) selectCell(cell);
                        if(r === r2 && c === c2) break;
                        r += dr;
                        c += dc;
                    }
                }
            }
        }

        function checkWordMatch() {
            const wordStr = selectedCells.map(c => c.textContent).join('');
            const wordStrRev = wordStr.split('').reverse().join('');
            const matchIdx = targetWords.findIndex(t => !t.found && (t.word === wordStr || t.word === wordStrRev));
            
            if (matchIdx !== -1) {
                foundWord(matchIdx, selectedCells);
            } else {
                selectedCells.forEach(c => c.classList.add('wrong-flash'));
                setTimeout(clearSelection, 500);
            }
        }

        function foundWord(idx, cells, isAuto = false) {
            const wordObj = targetWords[idx];
            wordObj.found = true;
            const color = PASTEL_COLORS[idx % PASTEL_COLORS.length];
            wordObj.color = color;

            cells.forEach(c => {
                c.classList.remove('selected');
                c.classList.add('found');
                c.style.backgroundColor = color;
            });

            const li = document.getElementById(`clue-${idx}`);
            li.classList.add('found');
            li.style.backgroundColor = color;

            if(!isAuto) {
                speakText(wordObj.word, 'en-US');
            }

            updateStatus();
            
            if(!isAuto && targetWords.every(t => t.found)) {
                setTimeout(finishGame, 1500);
            }
        }

        function giveHint(idx) {
            const w = targetWords[idx];
            if(w.found) return;
            document.getElementById(`clue-${idx}`).classList.add('hint-used');
            const meta = placedWordsMeta.find(m => m.word === w.word);
            const cells = getCellsFromMeta(meta);
            foundWord(idx, cells);
        }

        function getCellsFromMeta(meta) {
            const cells = [];
            const r1 = meta.start.r, c1 = meta.start.c;
            const r2 = meta.end.r, c2 = meta.end.c;
            const dr = Math.sign(r2-r1);
            const dc = Math.sign(c2-c1);
            let r=r1, c=c1;
            while(true) {
                cells.push(getCell(r,c));
                if(r===r2 && c===c2) break;
                r+=dr; c+=dc;
            }
            return cells;
        }

        // --- AUTOPLAY LOGIC ---
        async function runAutoplayLoop() {
            for (let i = 0; i < targetWords.length; i++) {
                if (!isGameRunning || !isAutoplayMode) break;
                const wordObj = targetWords[i];
                if (wordObj.found) continue;

                const meta = placedWordsMeta.find(m => m.word === wordObj.word);
                const cells = getCellsFromMeta(meta);

                foundWord(i, cells, true); 

                await speakText(wordObj.word, 'en-US');
                if (!isGameRunning || !isAutoplayMode) break;

                await speakText(wordObj.clue, 'th-TH');
                if (!isGameRunning || !isAutoplayMode) break;

                await new Promise(r => setTimeout(r, 1500));
            }

            if (isGameRunning && isAutoplayMode) {
                finishGame();
            }
        }

        // --- TIMER ---
        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const delta = Math.floor((Date.now() - startTime)/1000);
                totalTimeSeconds = delta;
                const m = Math.floor(delta / 60).toString().padStart(2,'0');
                const s = (delta % 60).toString().padStart(2,'0');
                document.getElementById('timer-display').textContent = `${m}:${s}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        // --- FINISH ---
        function finishGame() {
            isGameRunning = false;
            stopTimer();
            
            summaryListEl.innerHTML = '';
            targetWords.forEach(w => {
                const li = document.createElement('li');
                li.className = 'summary-item';
                li.innerHTML = `<span>${w.word}</span> <span>${w.clue}</span>`;
                summaryListEl.appendChild(li);
            });

            document.getElementById('summary-score').textContent = `‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏à‡∏≠: ${targetWords.length}/${targetWords.length}`;
            document.getElementById('summary-time').textContent = `‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${document.getElementById('timer-display').textContent}`;
            
            showScreen('summary-screen');
        }

        // --- INIT EVENTS ---
        gridEl.addEventListener('mousedown', handleStart);
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('mouseup', handleEnd);
        gridEl.addEventListener('touchstart', handleStart, {passive: false});
        gridEl.addEventListener('touchmove', handleMove, {passive: false});
        gridEl.addEventListener('touchend', handleEnd);

        document.getElementById('game-title').addEventListener('click', handleTitleTap);
        
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.onclick = function() {
                if(this.dataset.category) selectCategory(this.dataset.category);
            }
        });

        document.getElementById('restart-btn').onclick = () => {
            if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å? ‡πÄ‡∏Å‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')) {
                isGameRunning = false;
                showScreen('start-screen');
            }
        };
        
        document.getElementById('summary-btn').onclick = () => showScreen('start-screen');

        if('speechSynthesis' in window) window.speechSynthesis.getVoices();

    </script>
</body>
</html>
