<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Search</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- THEME & GLOBAL STYLES --- */
        :root {
            --color-primary: #29B6F6; /* Brighter Blue */
            --color-secondary-select: #42A5F5; /* Blue - For single selection */
            --color-wrong: #EF5350; /* Red - For Incorrect Flash */
            --color-bg: #80DEEA; /* Light Cyan/Aqua Background */
            --color-card: #FFFFFF; /* White Card/Container */
            --color-text-dark: #2C3E50; /* Dark Text */
            --color-text-light: #FFFFFF;
            --color-header: var(--color-primary); 
            --color-grid-line: #BBDEFB; /* Light Blue Grid Separator */
            --color-category-btn: #FFD54F; /* Amber for category buttons */
            --color-difficulty-btn: #66BB6A; /* Light Green for difficulty */
        }

        /* Screen Management */
        .screen {
            padding: 0 1rem 1rem;
            display: none;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        .active-screen {
            display: flex;
        }

        /* Responsive Container */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            text-align: center;
        }

        .container {
            width: 100%;
            max-width: 500px; 
            box-sizing: border-box;
            background-color: var(--color-card);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 0;
        }

        /* Header */
        header {
            background-color: var(--color-header); 
            color: var(--color-text-light);
            padding: 1.5rem 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
            margin-bottom: 1rem;
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏° cursor: pointer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
            cursor: pointer; 
        }

        /* --- AUTOPLAY SECRET MODE CSS --- */
        @keyframes slowPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.03); opacity: 0.85; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pulsing-title {
            animation: slowPulse 2s ease-in-out infinite;
        }
        /* --- END AUTOPLAY SECRET MODE CSS --- */


        /* Status Bar & Timer */
        #status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            margin-bottom: 0.5rem;
            padding: 0 1rem;
            color: var(--color-text-dark);
        }
        #timer-display {
            background-color: #E0E0E0;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 1.1rem;
        }

        /* --- GAME SPECIFIC STYLES --- */
        
        /* --- Grid (The Search Area) --- */
        #word-search-grid {
            display: grid;
            width: 100%;
            max-width: 480px; 
            margin: 0 auto;
            border: 2px solid var(--color-grid-line);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
            user-select: none; 
            touch-action: manipulation; 
        }

        .grid-cell {
            aspect-ratio: 1 / 1; 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            color: var(--color-text-dark);
            border: 1px solid var(--color-grid-line);
            box-sizing: border-box;
            transition: transform 0.1s;
            background-color: transparent; 
        }

        /* Selection States */
        .grid-cell.selected {
            background-color: var(--color-secondary-select);
            color: var(--color-text-light);
            transform: scale(1.05); 
            z-index: 10;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        /* Found State: Applied via inline style for dynamic color/opacity */
        .grid-cell.found {
            color: var(--color-text-dark); 
            font-weight: 900;
            /* background-color applied via JS with 50% opacity */
        }
        
        /* Wrong Guess Flash (Red) */
        .grid-cell.wrong-flash {
            background-color: var(--color-wrong) !important; 
            color: var(--color-text-light) !important;
            animation: wrongFlash 1s ease-out; 
        }
        
        @keyframes wrongFlash {
            0% { background-color: var(--color-wrong); }
            50% { background-color: var(--color-wrong); }
            100% { background-color: inherit; color: inherit; } 
        }

        /* --- Clues Area (The List) --- */
        #clue-panel {
            text-align: left;
            background-color: #F0F4C3; 
            padding: 15px;
            border-radius: 8px;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }
        #clue-panel h3 {
            margin-top: 0;
            color: var(--color-text-dark);
            font-size: 1.3rem;
            border-bottom: 2px solid #C5E1A5;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        #clue-list {
            list-style: none;
            padding: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); 
            gap: 10px;
        }
        .clue-item {
            background-color: #E0E0E0; 
            padding: 10px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--color-text-dark);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer; 
        }
        
        /* Styles when a word is solved/found */
        .clue-item.found {
            opacity: 1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            font-size: 1.1rem; 
            cursor: default;
        }

        /* Hint/Solve Specific Style */
        .clue-item.hint-used {
            background-color: #FFCDD2FF !important; 
            border: 2px dashed #EF5350;
            color: var(--color-text-dark); 
        }
        
        .clue-hint {
            display: block;
            font-size: 0.8rem;
            font-weight: 400;
            color: #757575; 
            margin-top: 5px;
        }
        
        .clue-word-text {
            display: none; 
            font-weight: 900;
            font-size: 1.2rem;
            text-transform: uppercase;
        }
        
        .clue-item.found .clue-hint {
            display: none;
        }
        .clue-item.found .clue-word-text {
            display: block;
            color: var(--color-text-dark); 
        }

        /* Summary Screen Styles */
        #summary-screen h2 {
            font-size: 2rem;
            color: var(--color-primary);
            margin-bottom: 1.5rem;
        }
        .summary-stat {
            background-color: #F3E5F5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* --- BUTTON STYLES --- */
        .main-btn {
            color: var(--color-text-light);
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            width: 100%;
            margin-top: 1rem;
        }
        .main-btn:active {
            transform: translateY(2px);
        }
        .main-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .category-btn {
            background-color: var(--color-category-btn);
            box-shadow: 0 4px 0 #FFC107; 
        }
        .difficulty-btn {
            background-color: var(--color-difficulty-btn);
            box-shadow: 0 4px 0 #388E3C;
        }
        .difficulty-btn:active {
            box-shadow: 0 2px 0 #388E3C;
        }
        .category-btn:active {
            box-shadow: 0 2px 0 #FFC107;
        }
        #summary-btn, #restart-btn {
             background-color: var(--color-secondary-select);
             box-shadow: 0 4px 0 #3188d6;
        }
        #summary-btn:active, #restart-btn:active {
            box-shadow: 0 2px 0 #3188d6;
        }


    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1 id="game-title">Word Search</h1>
        </header>

        <div id="start-screen" class="screen active-screen">
            <h2 style="color: var(--color-primary); margin-bottom: 0;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏Å‡∏° Word Search! üîç</h2>
            <p style="font-size: 1.1rem; margin-top: 0.5rem; margin-bottom: 1.5rem;">‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</p>
            
            <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
            <button class="main-btn category-btn" data-category="animals">
                ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ (Animals)
            </button>
            <button class="main-btn category-btn" data-category="fruits">
                ‡∏ú‡∏•‡πÑ‡∏°‡πâ (Fruits)
            </button>
            <button class="main-btn category-btn" data-category="colors">
                ‡∏™‡∏µ (Colors)
            </button>
            <button class="main-btn category-btn" data-category="foods">
                ‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Foods)
            </button>
        </div>

        <div id="difficulty-screen" class="screen">
            <h2 id="difficulty-category-title">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤</h2>
            <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</h3>
            <button class="main-btn difficulty-btn" data-difficulty="easy">
                ‡∏á‡πà‡∏≤‡∏¢ (6x6, 6 ‡∏Ñ‡∏≥, ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≤‡∏Å 20 ‡∏Ñ‡∏≥)
            </button>
            <button class="main-btn difficulty-btn" data-difficulty="hard">
                ‡∏¢‡∏≤‡∏Å (10x10, 10 ‡∏Ñ‡∏≥, ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≤‡∏Å 20 ‡∏Ñ‡∏≥)
            </button>
        </div>

        <div id="game-screen" class="screen">
            <div id="status-bar">
                <span id="category-title"></span>
                <span id="score">‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏û‡∏ö: 0/10</span>
                <span id="timer-display">‡πÄ‡∏ß‡∏•‡∏≤: 00:00</span>
            </div>

            <div id="word-search-grid">
                </div>

            <div id="clue-panel">
                <h3>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (Clues)</h3>
                <p style="font-size: 0.9rem; color: #5D4037;">*‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏•‡∏¢ (- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)*</p>
                <ul id="clue-list">
                    </ul>
            </div>
            
            <button id="restart-btn" class="main-btn">
                ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
        </div>
        
        <div id="summary-screen" class="screen">
            <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h2>
            <div class="summary-stat">
                <p id="summary-score"></p>
            </div>
            <div class="summary-stat">
                <p id="summary-time"></p>
            </div>
            
            <button id="summary-btn" class="main-btn">
                ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
        </div>
    </div>

    <script>
        // --- AUDIO/SPEECH LOGIC ---
        let audioContext;
        let voices = [];
        
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        function setupSpeech() {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.onvoiceschanged = () => {
                    voices = window.speechSynthesis.getVoices();
                };
            }
        }
        function getVoice(lang) {
             return voices.find(v => v.lang.startsWith(lang)) || voices.find(v => v.lang.startsWith(lang.substring(0, 2))) || null;
        }
        function speakText(text, lang) {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            // Use a slightly slower rate for better English word recognition
            utterance.rate = (lang === 'en-US') ? 0.75 : 0.9; 
            utterance.volume = 1;
            const targetVoice = getVoice('en-US');
            if (targetVoice) utterance.voice = targetVoice;
            window.speechSynthesis.speak(utterance);
        }
        function createTone(frequency, duration, type, volume = 0.5) {
            initAudioContext();
            if (!audioContext || audioContext.state === 'suspended') return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type; 
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.00001, audioContext.currentTime + duration);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }
        function playSuccessTone() { createTone(660, 0.15, 'sine', 0.8); }
        function playFailTone() { createTone(150, 0.4, 'triangle', 0.7); }
        // --- END AUDIO/SPEECH LOGIC ---

    </script>

    <script>
        // --- CONFIGURATION & DATA (Updated with all categories) ---
        const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const WORD_CATEGORIES = {
            'animals': {
                name: '‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡πà‡∏≤ (Animals)',
                easyWordsPool: [
                    { word: "CAT", clue: "‡πÅ‡∏°‡∏ß" },
                    { word: "DOG", clue: "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç" },
                    { word: "FOX", clue: "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å" },
                    { word: "LION", clue: "‡∏£‡∏≤‡∏ä‡∏≤‡πÅ‡∏´‡πà‡∏á‡∏õ‡πà‡∏≤" },
                    { word: "CUB", clue: "‡∏•‡∏π‡∏Å‡∏™‡∏¥‡∏á‡πÇ‡∏ï/‡∏´‡∏°‡∏µ" },
                    { word: "DEER", clue: "‡∏Å‡∏ß‡∏≤‡∏á" },
                    { word: "WOLF", clue: "‡∏´‡∏°‡∏≤‡∏õ‡πà‡∏≤" },
                    { word: "EEL", clue: "‡∏õ‡∏•‡∏≤‡πÑ‡∏´‡∏•" },
                    { word: "BAT", clue: "‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏≤‡∏ß" },
                    { word: "PIG", clue: "‡∏´‡∏°‡∏π" },
                    { word: "RAT", clue: "‡∏´‡∏ô‡∏π" },
                    { word: "COW", clue: "‡∏ß‡∏±‡∏ß" },
                    { word: "BULL", clue: "‡∏ß‡∏±‡∏ß‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ" },
                    { word: "GOAT", clue: "‡πÅ‡∏û‡∏∞" },
                    { word: "SHEEP", clue: "‡πÅ‡∏Å‡∏∞" },
                    { word: "CRAB", clue: "‡∏õ‡∏π" },
                    { word: "FISH", clue: "‡∏õ‡∏•‡∏≤" },
                    { word: "FROG", clue: "‡∏Å‡∏ö" },
                    { word: "DUCK", clue: "‡πÄ‡∏õ‡πá‡∏î" },
                    { word: "OWL", clue: "‡∏ô‡∏Å‡∏Æ‡∏π‡∏Å" },
                ],
                hardWordsPool: [
                    { word: "TIGER", clue: "‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏•‡πÅ‡∏°‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏™‡∏µ‡∏î‡∏≥‡∏ö‡∏ô‡∏Ç‡∏ô‡∏™‡∏µ‡∏™‡πâ‡∏°" },
                    { word: "ZEBRA", clue: "‡∏°‡πâ‡∏≤‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡∏™‡∏µ‡∏î‡∏≥‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏ß" },
                    { word: "BEAR", clue: "‡∏´‡∏°‡∏µ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥‡∏ú‡∏∂‡πâ‡∏á" },
                    { word: "EAGLE", clue: "‡∏ô‡∏Å‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏µ ‡∏ô‡∏Å‡∏•‡πà‡∏≤‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà" },
                    { word: "SNAKE", clue: "‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏∑‡πâ‡∏≠‡∏¢‡∏Ñ‡∏•‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≤" },
                    { word: "DOLPHIN", clue: "‡πÇ‡∏•‡∏°‡∏≤ ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏°‡πÉ‡∏ô‡∏ó‡∏∞‡πÄ‡∏•" },
                    { word: "ELEPHANT", clue: "‡∏ä‡πâ‡∏≤‡∏á ‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ö‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î" },
                    { word: "GIRAFFE", clue: "‡∏¢‡∏µ‡∏£‡∏≤‡∏ü ‡∏Ñ‡∏≠‡∏¢‡∏≤‡∏ß" },
                    { word: "MONKEY", clue: "‡∏•‡∏¥‡∏á ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏°‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏õ‡∏µ‡∏ô‡∏õ‡πà‡∏≤‡∏¢" },
                    { word: "RABBIT", clue: "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢ ‡∏´‡∏π‡∏¢‡∏≤‡∏ß ‡∏ä‡∏≠‡∏ö‡∏Å‡∏¥‡∏ô‡πÅ‡∏Ñ‡∏£‡∏≠‡∏ó" },
                    { word: "PENGUIN", clue: "‡∏ô‡∏Å‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô ‡∏ö‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ß‡πÇ‡∏•‡∏Å" },
                    { word: "PARROT", clue: "‡∏ô‡∏Å‡πÅ‡∏Å‡πâ‡∏ß ‡∏ô‡∏Å‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ" },
                    { word: "CHIMPANZEE", clue: "‡∏•‡∏¥‡∏á‡∏ä‡∏¥‡∏°‡πÅ‡∏õ‡∏ô‡∏ã‡∏µ" },
                    { word: "RHINOS", clue: "‡πÅ‡∏£‡∏î" },
                    { word: "CAMEL", clue: "‡∏≠‡∏π‡∏ê" },
                    { word: "TURTLE", clue: "‡πÄ‡∏ï‡πà‡∏≤" },
                    { word: "CROCODILE", clue: "‡∏à‡∏£‡∏∞‡πÄ‡∏Ç‡πâ" },
                    { word: "KANGAROO", clue: "‡∏à‡∏¥‡∏á‡πÇ‡∏à‡πâ" },
                    { word: "OSTRICH", clue: "‡∏ô‡∏Å‡∏Å‡∏£‡∏∞‡∏à‡∏≠‡∏Å‡πÄ‡∏ó‡∏®" },
                    { word: "HIPPO", clue: "‡∏Æ‡∏¥‡∏õ‡πÇ‡∏õ" },
                ],
                easy: {
                    size: 6, 
                    targetWordCount: 6, 
                    poolKey: 'easyWordsPool'
                },
                hard: {
                    size: 10,
                    targetWordCount: 10, 
                    poolKey: 'hardWordsPool'
                }
            },
            'fruits': { 
                name: '‡∏ú‡∏•‡πÑ‡∏°‡πâ (Fruits)',
                easyWordsPool: [
                    { word: "APPLE", clue: "‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•" },
                    { word: "BANANA", clue: "‡∏Å‡∏•‡πâ‡∏ß‡∏¢" },
                    { word: "GRAPE", clue: "‡∏≠‡∏á‡∏∏‡πà‡∏ô" },
                    { word: "PEAR", clue: "‡∏•‡∏π‡∏Å‡πÅ‡∏û‡∏£‡πå" },
                    { word: "KIWI", clue: "‡∏Å‡∏µ‡∏ß‡∏µ‡πà" },
                    { word: "LIME", clue: "‡∏°‡∏∞‡∏ô‡∏≤‡∏ß" },
                    { word: "FIG", clue: "‡∏°‡∏∞‡πÄ‡∏î‡∏∑‡πà‡∏≠" },
                    { word: "BERRY", clue: "‡∏ú‡∏•‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà" },
                    { word: "MELON", clue: "‡πÅ‡∏ï‡∏á‡πÇ‡∏°" },
                    { word: "DATE", clue: "‡∏≠‡∏¥‡∏ô‡∏ó‡∏ú‡∏•‡∏±‡∏°" },
                    { word: "PLUM", clue: "‡∏•‡∏π‡∏Å‡∏û‡∏•‡∏±‡∏°" },
                    { word: "MANGO", clue: "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á" },
                    { word: "PEACH", clue: "‡∏•‡∏π‡∏Å‡∏û‡∏µ‡∏ä" },
                    { word: "CHERRY", clue: "‡πÄ‡∏ä‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà" },
                    { word: "GUAVA", clue: "‡∏ù‡∏£‡∏±‡πà‡∏á" },
                    { word: "SAGO", clue: "‡∏™‡∏≤‡∏Ñ‡∏π" },
                    { word: "COCOA", clue: "‡πÄ‡∏°‡∏•‡πá‡∏î‡πÇ‡∏Å‡πÇ‡∏Å‡πâ" },
                    { word: "LEMON", clue: "‡∏°‡∏∞‡∏ô‡∏≤‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" },
                    { word: "MINT", clue: "‡∏™‡∏∞‡∏£‡∏∞‡πÅ‡∏´‡∏ô‡πà" },
                    { word: "ORANGE", clue: "‡∏™‡πâ‡∏°" },
                ],
                hardWordsPool: [
                    { word: "PINEAPPLE", clue: "‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î" },
                    { word: "STRAWBERRY", clue: "‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ" },
                    { word: "WATERMELON", clue: "‡πÅ‡∏ï‡∏á‡πÇ‡∏°‡∏•‡∏π‡∏Å‡πÉ‡∏´‡∏ç‡πà" },
                    { word: "AVOCADO", clue: "‡∏≠‡∏∞‡πÇ‡∏ß‡∏Ñ‡∏≤‡πÇ‡∏î" },
                    { word: "BLUEBERRY", clue: "‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ" },
                    { word: "RASPBERRY", clue: "‡∏£‡∏≤‡∏™‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ" },
                    { word: "GRAPEFRUIT", clue: "‡∏™‡πâ‡∏°‡πÇ‡∏≠‡∏ù‡∏£‡∏±‡πà‡∏á" },
                    { word: "POMEGRANATE", clue: "‡∏ó‡∏±‡∏ö‡∏ó‡∏¥‡∏°" },
                    { word: "TANGERINE", clue: "‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏ß‡∏≤‡∏ô" },
                    { word: "APRICOT", clue: "‡πÅ‡∏≠‡∏õ‡∏£‡∏¥‡∏Ñ‡∏≠‡∏ó" },
                    { word: "COCONUT", clue: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß" },
                    { word: "PAPAYA", clue: "‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠" },
                    { word: "DURIAN", clue: "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" },
                    { word: "LYCHEE", clue: "‡∏•‡∏¥‡πâ‡∏ô‡∏à‡∏µ‡πà" },
                    { word: "RAMBUTAN", clue: "‡πÄ‡∏á‡∏≤‡∏∞" },
                    { word: "PASSIONFRUIT", clue: "‡πÄ‡∏™‡∏≤‡∏ß‡∏£‡∏™" },
                    { word: "CANTALOUPE", clue: "‡πÅ‡∏Ñ‡∏ô‡∏ï‡∏≤‡∏•‡∏π‡∏õ" },
                    { word: "DRAGONFRUIT", clue: "‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏±‡∏á‡∏Å‡∏£" },
                    { word: "STARFRUIT", clue: "‡∏°‡∏∞‡πÄ‡∏ü‡∏∑‡∏≠‡∏á" },
                    { word: "POMELO", clue: "‡∏™‡πâ‡∏°‡πÇ‡∏≠" },
                ],
                easy: {
                    size: 6, 
                    targetWordCount: 6, 
                    poolKey: 'easyWordsPool'
                },
                hard: {
                    size: 10,
                    targetWordCount: 10, 
                    poolKey: 'hardWordsPool'
                }
            },
            'colors': { 
                name: '‡∏™‡∏µ (Colors)',
                easyWordsPool: [
                    { word: "RED", clue: "‡∏™‡∏µ‡πÅ‡∏î‡∏á" },
                    { word: "BLUE", clue: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô" },
                    { word: "GREEN", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" },
                    { word: "PINK", clue: "‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π" },
                    { word: "BLACK", clue: "‡∏™‡∏µ‡∏î‡∏≥" },
                    { word: "WHITE", clue: "‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß" },
                    { word: "GREY", clue: "‡∏™‡∏µ‡πÄ‡∏ó‡∏≤" },
                    { word: "GOLD", clue: "‡∏™‡∏µ‡∏ó‡∏≠‡∏á" },
                    { word: "SILVER", clue: "‡∏™‡∏µ‡πÄ‡∏á‡∏¥‡∏ô" },
                    { word: "ORANGE", clue: "‡∏™‡∏µ‡∏™‡πâ‡∏°" },
                    { word: "PURPLE", clue: "‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á" },
                    { word: "BROWN", clue: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•" },
                    { word: "YELLOW", clue: "‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" },
                    { word: "VIOLET", clue: "‡∏™‡∏µ‡πÑ‡∏ß‡πÇ‡∏≠‡πÄ‡∏•‡∏ï" },
                    { word: "CYAN", clue: "‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô" },
                    { word: "TEAL", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•" },
                    { word: "BEIGE", clue: "‡∏™‡∏µ‡πÄ‡∏ö‡∏à" },
                    { word: "LIME", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏ô‡∏≤‡∏ß" },
                    { word: "NAVY", clue: "‡∏™‡∏µ‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤" },
                    { word: "ROSE", clue: "‡∏™‡∏µ‡∏î‡∏≠‡∏Å‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö" },
                ],
                hardWordsPool: [
                    { word: "CRIMSON", clue: "‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°" },
                    { word: "MAGENTA", clue: "‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡πÅ‡∏î‡∏á" },
                    { word: "TURQUOISE", clue: "‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" },
                    { word: "AQUAMARINE", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡∏≠‡πà‡∏≠‡∏ô" },
                    { word: "CHOCOLATE", clue: "‡∏™‡∏µ‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï" },
                    { word: "INDIGO", clue: "‡∏™‡∏µ‡∏Ñ‡∏£‡∏≤‡∏°" },
                    { word: "SCARLET", clue: "‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏™‡∏î" },
                    { word: "EMERALD", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏£‡∏Å‡∏ï" },
                    { word: "MAROON", clue: "‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏´‡∏°‡∏π" },
                    { word: "CHARCOAL", clue: "‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°" },
                    { word: "FUCHSIA", clue: "‡∏™‡∏µ‡∏ö‡∏≤‡∏ô‡πÄ‡∏¢‡πá‡∏ô" },
                    { word: "LAVENDER", clue: "‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô" },
                    { word: "BRONZE", clue: "‡∏™‡∏µ‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á" },
                    { word: "MUSTARD", clue: "‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏°‡∏±‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏î" },
                    { word: "OLIVE", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏∞‡∏Å‡∏≠‡∏Å" },
                    { word: "SALMON", clue: "‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏≠‡∏°‡∏ä‡∏°‡∏û‡∏π" },
                    { word: "TAN", clue: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏≠‡πà‡∏≠‡∏ô" },
                    { word: "AZURE", clue: "‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏Ñ‡∏£‡∏≤‡∏°" },
                    { word: "KHAKI", clue: "‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÅ‡∏Å‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" },
                    { word: "JADE", clue: "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏¢‡∏Å" },
                ],
                easy: {
                    size: 6, 
                    targetWordCount: 6, 
                    poolKey: 'easyWordsPool'
                },
                hard: {
                    size: 10,
                    targetWordCount: 10, 
                    poolKey: 'hardWordsPool'
                }
            },
            'foods': { 
                name: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (Foods)',
                easyWordsPool: [
                    { word: "RICE", clue: "‡∏Ç‡πâ‡∏≤‡∏ß" },
                    { word: "MEAT", clue: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠" },
                    { word: "FISH", clue: "‡∏õ‡∏•‡∏≤" },
                    { word: "BREAD", clue: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á" },
                    { word: "EGG", clue: "‡πÑ‡∏Ç‡πà" },
                    { word: "SOUP", clue: "‡∏ã‡∏∏‡∏õ" },
                    { word: "CAKE", clue: "‡πÄ‡∏Ñ‡πâ‡∏Å" },
                    { word: "PIZZA", clue: "‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤" },
                    { word: "NOODLE", clue: "‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß/‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà" },
                    { word: "SALAD", clue: "‡∏™‡∏•‡∏±‡∏î" },
                    { word: "BEAN", clue: "‡∏ñ‡∏±‡πà‡∏ß" },
                    { word: "CHEESE", clue: "‡πÄ‡∏ô‡∏¢‡πÅ‡∏Ç‡πá‡∏á" },
                    { word: "ONION", clue: "‡∏´‡∏±‡∏ß‡∏´‡∏≠‡∏°" },
                    { word: "CORN", clue: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î" },
                    { word: "SUGAR", clue: "‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•" },
                    { word: "SALT", clue: "‡πÄ‡∏Å‡∏•‡∏∑‡∏≠" },
                    { word: "MILK", clue: "‡∏ô‡∏°" },
                    { word: "OAT", clue: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏≠‡πä‡∏ï" },
                    { word: "TEA", clue: "‡∏ä‡∏≤" },
                    { word: "COFFEE", clue: "‡∏Å‡∏≤‡πÅ‡∏ü" },
                ],
                hardWordsPool: [
                    { word: "SPAGHETTI", clue: "‡∏™‡∏õ‡∏≤‡πÄ‡∏Å‡∏ï‡∏ï‡∏µ" },
                    { word: "SANDWICH", clue: "‡πÅ‡∏ã‡∏ô‡∏î‡πå‡∏ß‡∏¥‡∏ä" },
                    { word: "HAMBURGER", clue: "‡πÅ‡∏Æ‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏Å‡∏≠‡∏£‡πå" },
                    { word: "PANCAKE", clue: "‡πÅ‡∏û‡∏ô‡πÄ‡∏Ñ‡πâ‡∏Å" },
                    { word: "CEREAL", clue: "‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏•" },
                    { word: "BROCCOLI", clue: "‡∏ö‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏•‡∏µ" },
                    { word: "CARROT", clue: "‡πÅ‡∏Ñ‡∏£‡∏≠‡∏ó" },
                    { word: "POTATO", clue: "‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á" },
                    { word: "CHICKEN", clue: "‡πÑ‡∏Å‡πà" },
                    { word: "BURRITO", clue: "‡∏ö‡∏π‡∏£‡πå‡∏£‡∏¥‡πÇ‡∏ï" },
                    { word: "TACO", clue: "‡∏ó‡∏≤‡πÇ‡∏Å‡πâ" },
                    { word: "SUSHI", clue: "‡∏ã‡∏π‡∏ä‡∏¥" },
                    { word: "BACON", clue: "‡πÄ‡∏ö‡∏Ñ‡∏≠‡∏ô" },
                    { word: "DONUT", clue: "‡πÇ‡∏î‡∏ô‡∏±‡∏ó" },
                    { word: "WAFFLE", clue: "‡∏ß‡∏≤‡∏ü‡πÄ‡∏ü‡∏¥‡∏•" },
                    { word: "KETCHUP", clue: "‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®" },
                    { word: "MAYO", clue: "‡∏°‡∏≤‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏™" },
                    { word: "VINEGAR", clue: "‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°‡∏™‡∏≤‡∏¢‡∏ä‡∏π" },
                    { word: "YOGURT", clue: "‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï" },
                    { word: "COLA", clue: "‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°‡πÇ‡∏Ñ‡∏•‡πà‡∏≤" },
                ],
                easy: {
                    size: 6, 
                    targetWordCount: 6, 
                    poolKey: 'easyWordsPool'
                },
                hard: {
                    size: 10,
                    targetWordCount: 10, 
                    poolKey: 'hardWordsPool'
                }
            }
        };

        // Pastel colors with 50% opacity (Hex with 80 transparency)
        const PASTEL_COLORS = [
            '#FFC0CB80', // Pink
            '#ADD8E680', // Light Blue
            '#90EE9080', // Light Green
            '#F0808080', // Light Coral
            '#DDA0DD80', // Plum
            '#B0E0E680', // Powder Blue
            '#F5DEB380', // Wheat
            '#AFEEEE80', // Pale Turquoise
            '#E6E6FA80', // Lavender
            '#FFE4B580'  // Moccasin
        ];


        // --- GAME STATE ---
        let GRID_SIZE = 10;
        let targetWords = [];
        let grid = [];
        let placedWordsMeta = []; 
        let startCell = null; 
        let selectedCells = []; 
        let currentConfig = null;
        
        let timerInterval;
        let autoplayTimeout; // ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ setTimeout ‡∏Ç‡∏≠‡∏á‡πÇ‡∏´‡∏°‡∏î Autoplay
        let startTime;
        let totalTimeSeconds = 0;
        let isAutoplayMode = false; // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥


        // --- ELEMENTS ---
        const screens = {
            'start-screen': document.getElementById('start-screen'),
            'difficulty-screen': document.getElementById('difficulty-screen'),
            'game-screen': document.getElementById('game-screen'),
            'summary-screen': document.getElementById('summary-screen')
        };
        const gridEl = document.getElementById('word-search-grid');
        const clueListEl = document.getElementById('clue-list');
        const scoreEl = document.getElementById('score');
        const categoryTitleEl = document.getElementById('category-title');
        const timerDisplayEl = document.getElementById('timer-display');
        const gameTitleEl = document.getElementById('game-title');


        // --- AUTOPLAY TOGGLE LOGIC ---
        function toggleAutoplayMode() {
            isAutoplayMode = !isAutoplayMode;
            if (isAutoplayMode) {
                gameTitleEl.classList.add('pulsing-title');
                alert("‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Autoplay Mode) ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•");
            } else {
                gameTitleEl.classList.remove('pulsing-title');
                alert("‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Autoplay Mode) ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß");
                // Clear any pending autoplay process if toggled off mid-game
                clearTimeout(autoplayTimeout); 
            }
        }
        
        // --- SCREEN MANAGEMENT ---
        function showScreen(id) {
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active-screen');
                screen.classList.add('hidden-screen');
            });
            screens[id].classList.add('active-screen');
            screens[id].classList.remove('hidden-screen');
            
            if (id !== 'game-screen') {
                stopTimer();
            }
        }
        
        function selectCategory(categoryId) {
            const category = WORD_CATEGORIES[categoryId];
            document.getElementById('difficulty-category-title').textContent = `‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${category.name}`;
            document.querySelectorAll('#difficulty-screen .difficulty-btn').forEach(btn => {
                btn.dataset.categoryId = categoryId;
            });
            showScreen('difficulty-screen');
        }

        function startGame(categoryId, difficulty) {
            const category = WORD_CATEGORIES[categoryId];
            currentConfig = category[difficulty];
            currentConfig.categoryId = categoryId; 
            
            // 1. Select Random Words
            const pool = category[currentConfig.poolKey];
            const filteredPool = pool.filter(w => w.word.length <= currentConfig.size);
            const shuffledPool = [...filteredPool].sort(() => 0.5 - Math.random());
            
            targetWords = shuffledPool.slice(0, currentConfig.targetWordCount).map(w => ({ 
                ...w, 
                word: w.word.toUpperCase(), 
                found: false, 
                colorIndex: -1, 
                hintUsed: false 
            }));

            // 2. Set Dynamic Config & State
            GRID_SIZE = currentConfig.size;
            clearSelection(false);
            
            // 3. Setup Grid and Clues
            generatePuzzle();
            renderGrid();
            renderClues();

            // 4. Setup UI and Start Timer/Autoplay
            categoryTitleEl.textContent = `‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: ${category.name} (${difficulty === 'easy' ? '‡∏á‡πà‡∏≤‡∏¢ 6x6' : '‡∏¢‡∏≤‡∏Å 10x10'})`;
            
            // Disable manual interaction if autoplay is on
            if (isAutoplayMode) {
                gridEl.style.pointerEvents = 'none'; 
                autoSolveNextWord(100); // Start autoplay with a small delay for grid rendering
            } else {
                gridEl.style.pointerEvents = 'auto'; 
            }
            
            startTimer();
            showScreen('game-screen');
        }


        // --- TIMER LOGIC ---
        function startTimer() {
            startTime = Date.now();
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            clearTimeout(autoplayTimeout); // Clear Autoplay timer
            if (startTime) {
                totalTimeSeconds = Math.floor((Date.now() - startTime) / 1000);
                startTime = null; 
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            if (!startTime) return;
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            timerDisplayEl.textContent = `‡πÄ‡∏ß‡∏•‡∏≤: ${formatTime(elapsed)}`;
        }
        

        // --- CORE GAME LOGIC (Puzzle Generation, Selection, Check) ---
        
        function createEmptyGrid() { grid = Array(GRID_SIZE).fill(0).map(() => Array(GRID_SIZE).fill('')); }
        function getRandomLetter() { return ALPHABET[Math.floor(Math.random() * ALPHABET.length)]; }
        function isSafe(r, c, len, direction) {
            const [dr, dc] = direction;
            if (r < 0 || r >= GRID_SIZE || c < 0 || c >= GRID_SIZE) return false;
            const newR = r + (len - 1) * dr;
            const newC = c + (len - 1) * dc;
            return newR >= 0 && newR < GRID_SIZE && newC >= 0 && newC < GRID_SIZE;
        }
        function checkWordFit(r, c, word, direction) {
            const [dr, dc] = direction;
            const len = word.length;
            if (!isSafe(r, c, len, direction)) return false;

            for (let i = 0; i < len; i++) {
                const char = grid[r + i * dr][c + i * dc];
                if (char !== '' && char !== word[i]) {
                    return false;
                }
            }
            return true;
        }
        function placeWord(r, c, word, direction) {
            const [dr, dc] = direction;
            for (let i = 0; i < word.length; i++) {
                grid[r + i * dr][c + i * dc] = word[i];
            }
        }
        function generatePuzzle() {
            createEmptyGrid();
            const directions = [ [0, 1], [1, 0], [1, 1], [-1, 0], [0, -1], [-1, -1], [1, -1], [-1, 1] ];
            placedWordsMeta = [];
            
            const placementWords = [...targetWords].sort((a, b) => b.word.length - a.word.length); 
            
            placementWords.forEach(wordObj => {
                const word = wordObj.word;
                let placed = false;
                let attempts = 0;

                while (!placed && attempts < 1000) { 
                    const r = Math.floor(Math.random() * GRID_SIZE);
                    const c = Math.floor(Math.random() * GRID_SIZE);
                    const direction = directions[Math.floor(Math.random() * directions.length)];

                    if (checkWordFit(r, c, word, direction)) {
                        placeWord(r, c, word, direction);
                        placedWordsMeta.push({ 
                            word: word, 
                            start: { r: r, c: c }, 
                            end: { r: r + (word.length - 1) * direction[0], c: c + (word.length - 1) * direction[1] } 
                        });
                        placed = true;
                    }
                    attempts++;
                }
                if (!placed) {
                    console.warn(`Could not place word: ${word}.`);
                }
            });

            // Fill Empty Cells
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (grid[r][c] === '') {
                        grid[r][c] = getRandomLetter();
                    }
                }
            }
        }

        function getCellsInLine(r1, c1, r2, c2) {
            const cells = [];
            const dr = Math.sign(r2 - r1);
            const dc = Math.sign(c2 - c1);
            
            const isHorizontal = r1 === r2 && c1 !== c2;
            const isVertical = c1 === c2 && r1 !== r2;
            const isDiagonal = Math.abs(r1 - r2) === Math.abs(c1 - c2) && r1 !== r2;
            
            if (r1 === r2 && c1 === c2) { 
                 const cellEl = gridEl.querySelector(`[data-row="${r1}"][data-col="${c1}"]`);
                 if (cellEl) cells.push(cellEl);
                 return cells;
            }
            
            if (!isHorizontal && !isVertical && !isDiagonal) return [];

            let r = r1;
            let c = c1;

            while (true) {
                const cellEl = gridEl.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                if (cellEl) cells.push(cellEl);

                if (r === r2 && c === c2) break;
                
                r += dr;
                c += dc;

                if (r < 0 || r >= GRID_SIZE || c < 0 || c >= GRID_SIZE) break;
            }
            return cells;
        }

        // --- Selection & Check Handlers ---
        function clearSelection(flash = false) {
            selectedCells.forEach(cell => {
                cell.classList.remove('selected'); 
                if (!cell.classList.contains('found')) { 
                    cell.style.transform = 'scale(1)'; 
                }
                
                if (flash) {
                    cell.classList.add('wrong-flash');
                    setTimeout(() => {
                        cell.classList.remove('wrong-flash');
                    }, 1000);
                } 
            });
            
            selectedCells = [];
            startCell = null;
        }
        
        function handleWordCheck() {
            if (selectedCells.length < 2) {
                clearSelection(false);
                return;
            }
            
            const selectedWord = selectedCells.map(cell => cell.textContent).join('');
            let foundIndex = -1;

            targetWords.forEach((wordObj, index) => {
                if (wordObj.found) return;

                const target = wordObj.word;
                const reversedTarget = target.split('').reverse().join('');

                if (selectedWord === target || selectedWord === reversedTarget) {
                    foundIndex = index;
                }
            });

            if (foundIndex !== -1) {
                markAsFound(foundIndex, selectedCells, targetWords[foundIndex]);
            } else {
                playFailTone();
                clearSelection(true); 
            }
        }

        function markAsFound(index, cells, wordDetails) {
            const foundWordsCountBefore = targetWords.filter(w => w.found).length;
            
            if (wordDetails.colorIndex === -1) {
                const colorIndex = foundWordsCountBefore % PASTEL_COLORS.length;
                wordDetails.colorIndex = colorIndex; 
            }
            
            const uniqueColor = PASTEL_COLORS[wordDetails.colorIndex];
            
            wordDetails.found = true;
            

            cells.forEach(cell => {
                cell.classList.remove('selected', 'wrong-flash');
                cell.classList.add('found');
                cell.style.transform = 'scale(1)'; 
                
                cell.style.backgroundColor = uniqueColor;
            });

            const clueEl = clueListEl.querySelector(`[data-index="${index}"]`);
            if (clueEl) {
                clueEl.classList.add('found');
                
                clueEl.style.backgroundColor = uniqueColor.substring(0, 7) + 'FF';
                
                if (wordDetails.hintUsed) {
                    clueEl.classList.add('hint-used');
                }
            }
            
            playSuccessTone();
            
            // Speak the word
            speakText(wordDetails.word.toLowerCase(), 'en-US'); 
            
            checkWinCondition();
            
            selectedCells = [];
            startCell = null;
            
            renderClues();
        }

        // Helper function to get word cell and placement data
        function getWordCellsAndPlacement(index) {
            const wordDetails = targetWords[index];
            const wordToSolve = wordDetails.word;
            const placement = placedWordsMeta.find(meta => meta.word === wordToSolve);

            if (!placement) {
                console.error(`Could not find placement for word: ${wordToSolve}`);
                return null;
            }
            
            const r1 = placement.start.r;
            const c1 = placement.start.c;
            const r2 = placement.end.r;
            const c2 = placement.end.c;
            const cellsToHighlight = getCellsInLine(r1, c1, r2, c2);
            
            // Determine the first and last cells (guaranteed to be 0 and length-1 since getCellsInLine orders them)
            const firstCell = cellsToHighlight[0];
            const lastCell = cellsToHighlight[cellsToHighlight.length - 1];
            
            return {
                wordDetails,
                cells: cellsToHighlight,
                first: firstCell,
                last: lastCell
            };
        }


        // --- AUTOPLAY CORE FUNCTION ---
        function autoSolveWordAnimation(index) {
            const data = getWordCellsAndPlacement(index);
            if (!data) return;

            const { wordDetails, cells, first, last } = data;
            
            // Ensure all cells are cleared from previous attempts or selections
            cells.forEach(cell => cell.classList.remove('selected', 'wrong-flash'));
            
            // Step 1: Highlight the first letter (0ms)
            first.classList.add('selected');

            // Step 2: Highlight the last letter (1000ms delay)
            setTimeout(() => {
                if (first !== last) { // Avoid double-selection if word is 1 letter
                    last.classList.add('selected');
                }
            }, 1000);

            // Step 3: Complete the selection and mark as found (2000ms delay)
            setTimeout(() => {
                // Highlight all remaining cells (this makes the word appear selected)
                cells.forEach(cell => cell.classList.add('selected'));

                // Find the word again, mark as 'hintUsed' and 'found'
                wordDetails.hintUsed = true; 
                markAsFound(index, cells, wordDetails);
                
                // Clear the 'selected' class, leaving only the 'found' class and color
                cells.forEach(cell => cell.classList.remove('selected'));
                
            }, 2000); // 2 seconds total for animation

            // Schedule the next word solution exactly 4 seconds after the START of this word's solution
            autoSolveNextWord(4000);
        }

        function autoSolveNextWord(delay = 4000) {
            clearTimeout(autoplayTimeout); // Clear any old pending timeout
            const nextIndex = targetWords.findIndex(w => !w.found);
            
            if (nextIndex !== -1) {
                // Set the next word solution to happen after the specified delay
                autoplayTimeout = setTimeout(() => {
                    // Check if mode is still active before running
                    if (isAutoplayMode) { 
                        autoSolveWordAnimation(nextIndex);
                    }
                }, delay);
            } else {
                // All words found, let checkWinCondition handle the final transition
            }
        }


        // --- HINT/SOLVE SYSTEM (MANUAL) ---
        function solveWord(index) {
            const wordDetails = targetWords[index];
            if (wordDetails.found) return;

            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            if (isAutoplayMode) {
                alert("‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢");
                return;
            }

            // Standard single-click hint mechanism
            wordDetails.hintUsed = true;
            
            const data = getWordCellsAndPlacement(index);
            if (!data) {
                alert(`‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "${wordDetails.word}" ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ß‡∏≤‡∏á‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤)`);
                return;
            }
            
            // Highlight all cells instantly for manual hint
            data.cells.forEach(cell => cell.classList.add('selected'));
            markAsFound(index, data.cells, wordDetails);
            data.cells.forEach(cell => cell.classList.remove('selected'));
        }


        // --- CLICK SELECTION HANDLER (START/END) ---
        function onCellClick(e) {
            if (isAutoplayMode) return; // Ignore clicks in autoplay mode

            const cell = e.target;
            
            if (!cell.classList.contains('grid-cell')) return; 

            if (startCell === null) {
                // First click: Set Start Cell
                clearSelection(false); 
                startCell = cell;
                startCell.classList.add('selected');
                selectedCells = [startCell];
            } else {
                // Second click: Set End Cell, Check Line, and Auto-Check Word
                const endCell = cell; 
                
                if (startCell === endCell) {
                    clearSelection(false);
                    return;
                }

                const r1 = parseInt(startCell.dataset.row);
                const c1 = parseInt(startCell.dataset.col);
                const r2 = parseInt(endCell.dataset.row);
                const c2 = parseInt(endCell.dataset.col);
                
                const isHorizontal = r1 === r2;
                const isVertical = c1 === c2;
                const isDiagonal = Math.abs(r1 - r2) === Math.abs(c1 - c2);

                if (isHorizontal || isVertical || isDiagonal) {
                    // Valid Line: Highlight the full path
                    selectedCells.forEach(c => c.classList.remove('selected'));
                    selectedCells = getCellsInLine(r1, c1, r2, c2);
                    selectedCells.forEach(c => c.classList.add('selected'));
                    
                    // Auto-check the word
                    handleWordCheck();
                } else {
                    // Invalid Line: Flash the start and end cell, then clear
                    selectedCells.forEach(c => c.classList.remove('selected'));
                    startCell.classList.add('selected');
                    endCell.classList.add('selected');
                    selectedCells = [startCell, endCell]; 
                    
                    playFailTone();
                    clearSelection(true); 
                }
            }
        }
        
        function attachGridListeners() {
            // Attach listener only once globally
            if (!gridEl.dataset.listenersAttached) {
                gridEl.addEventListener('click', onCellClick);
                gridEl.dataset.listenersAttached = 'true';
            }
        }
        
        // --- RENDERING & UI UPDATES ---
        function renderGrid() {
            gridEl.innerHTML = '';
            gridEl.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.textContent = grid[r][c];
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    gridEl.appendChild(cell);
                }
            }
            
            // Re-apply found state for persistence
            targetWords.filter(w => w.found).forEach(wordObj => {
                const wordMeta = placedWordsMeta.find(meta => meta.word === wordObj.word);
                if (wordMeta) {
                     const cells = getCellsInLine(wordMeta.start.r, wordMeta.start.c, wordMeta.end.r, wordMeta.end.c);
                     const uniqueColor = PASTEL_COLORS[wordObj.colorIndex];
                     cells.forEach(cell => {
                        cell.classList.add('found');
                        cell.style.backgroundColor = uniqueColor;
                     });
                }
            });
        }

        function renderClues() {
            clueListEl.innerHTML = '';
            targetWords.forEach((wordObj, index) => {
                const li = document.createElement('li');
                li.className = 'clue-item' + (wordObj.found ? ' found' : '');
                li.dataset.index = index;
                
                const hintSpan = document.createElement('span');
                hintSpan.className = 'clue-hint';
                hintSpan.textContent = wordObj.clue;
                
                const wordSpan = document.createElement('span');
                wordSpan.className = 'clue-word-text';
                wordSpan.textContent = wordObj.word;
                
                li.appendChild(wordSpan);
                li.appendChild(hintSpan);
                clueListEl.appendChild(li);

                if (wordObj.found) {
                     const uniqueColor = PASTEL_COLORS[wordObj.colorIndex];
                     li.style.backgroundColor = uniqueColor.substring(0, 7) + 'FF';
                     if (wordObj.hintUsed) {
                         li.classList.add('hint-used');
                     }
                } else {
                    // Attach listener only if not found
                    li.addEventListener('click', () => solveWord(index));
                }
            });
            checkWinCondition(); 
        }
        
        function checkWinCondition() {
            const foundCount = targetWords.filter(w => w.found).length;
            scoreEl.textContent = `‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏û‡∏ö: ${foundCount}/${targetWords.length}`;
            
            if (foundCount === targetWords.length) {
                // Game Over - Stop Autoplay and Add 1 second delay
                clearTimeout(autoplayTimeout);
                
                // 1. Temporarily disable grid interaction to prevent clicks during pause
                gridEl.style.pointerEvents = 'none'; 
                
                // 2. Set timeout for transition
                setTimeout(() => {
                    gridEl.style.pointerEvents = 'auto'; 
                    showSummaryScreen();
                }, 1000); // 1000 milliseconds = 1 second delay
            }
        }
        
        function showSummaryScreen() {
            stopTimer(); 
            showScreen('summary-screen');

            const timeString = formatTime(totalTimeSeconds);

            const totalFound = targetWords.length;
            const hintsUsed = targetWords.filter(w => w.hintUsed).length;
            const finalScore = Math.max(0, totalFound - hintsUsed); 
            
            document.getElementById('summary-score').innerHTML = `
                ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalFound} ‡∏Ñ‡∏≥<br>
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏á: ${totalFound - hintsUsed} ‡∏Ñ‡∏≥<br>
                ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ (‡πÄ‡∏â‡∏•‡∏¢): ${hintsUsed} ‡∏Ñ‡∏≥<br>
                <hr style="margin: 8px 0; border-color: #DDD;">
                <p style="font-size: 1.5rem; color: ${finalScore > 0 ? 'var(--color-primary)' : 'var(--color-wrong)'}; margin: 0;">
                    ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: **${finalScore}/${totalFound}** ‡∏Ñ‡∏≥
                </p>
            `;
            document.getElementById('summary-time').textContent = `‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ: ${timeString}`;
        }


        // --- INITIALIZATION & EVENT LISTENERS ---
        function init() {
            attachGridListeners(); 
            gameTitleEl.addEventListener('dblclick', toggleAutoplayMode); // Attach dblclick listener
            showScreen('start-screen');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            setupSpeech();
            document.addEventListener('click', () => {
                initAudioContext();
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });
            
            init(); 
        });

        // Event listeners for screen transitions
        document.getElementById('start-screen').addEventListener('click', (e) => {
            if (e.target.classList.contains('category-btn')) {
                selectCategory(e.target.dataset.category);
            }
        });
        
        document.getElementById('difficulty-screen').addEventListener('click', (e) => {
            if (e.target.classList.contains('difficulty-btn')) {
                const categoryId = e.target.dataset.categoryId;
                const difficulty = e.target.dataset.difficulty;
                startGame(categoryId, difficulty);
            }
        });
        
        document.getElementById('summary-screen').addEventListener('click', (e) => {
            if (e.target.id === 'summary-btn') {
                showScreen('start-screen');
            }
        });

        document.getElementById('restart-btn').addEventListener('click', (e) => {
             if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ")) {
                 showScreen('start-screen');
             }
        });
        
    </script>
</body>
</html>
